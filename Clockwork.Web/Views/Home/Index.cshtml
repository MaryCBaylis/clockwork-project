<script>

    $("document").ready(function(){
        $("#about").tooltip({"trigger": "click"});
        AnalogClock.init();
        var time = new Date();
        AnalogClock.draw(time);
    })
        
    function UserAction() {
        requestCurrentTime();
        requestPreviousRequestData();
    }

    function requestCurrentTime(){
        urlString = "http://127.0.0.1:5000/api/currenttime";
        successFunction = function(response) {
                document.getElementById("output").innerHTML = response;
                var time = parseTimeFromResponse(response);
                AnalogClock.draw(new Date(time));
        }
        sendGetRequest(urlString, successFunction);
    }

    function requestPreviousRequestData() {
        urlString = "http://127.0.0.1:5000/api/currentTime/requests";
        successFunction = function(response) {
            console.log(response);
        }
        sendGetRequest(urlString, successFunction);
    }

    function sendGetRequest(url, callback) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                callback(this.responseText);
            }
        };
        xhttp.open("GET", url, true);
        xhttp.setRequestHeader("Content-type", "application/json");
        xhttp.send();
    }

    function parseTimeFromResponse(response) {
        var time = JSON.parse(response).time;
        var date = new Date(Date.parse(time, "yyyy-MM-dd HH:mm z"));
        return date;
    }
    
</script>
<div class="row">
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
    <div class="header row col-lg-8 col-md-10">
        <h1>AWH 
            <span class="secondary-header">Clockwork Project</span>
        </h1>
        <span id="about" data-toggle="tooltip" data-placement="bottom" title="Version @ViewData["Version"] on @ViewData["Runtime"]!">
  <i class="fas fa-question-circle tertiary-header"></i></span> 
    </div>
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
</div>
<div class="row">
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
    <div class="jumbotron col-lg-8 col-md-10">
        <canvas id="canvas" width="400" height="400">
        </canvas>
        <button class="btn btn-lg col-md-8" type="submit" onclick="UserAction()">Get the Time</button>
    </div>
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
</div>
<div class="row">
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
    <div class="col-lg-8 col-md-10">
    @{
        Html.RenderPartial("_PreviousRequestsTable");
    }
    </div>
    <div class="spaceholder col-lg-2 col-md-1">
    </div>
</div>


@section head {
    <link href="Content/index.css" rel="stylesheet">
    <script src="Scripts/analogClock.js"></script>
    <script src="Scripts/index.js"></script>
}
